alertmanager:
  config:
    receivers:
    - name: 'pagerduty'
    pagerduty_configs:
      - routing_key: $PAGER_DUTY_API_KEY
        description: |-
          {{ template "pagerduty.custom.description" . }}
prometheus:
  prometheusSpec:
    additionalScrapeConfigs:
    - job_name: 'netdata-scrape'
      metrics_path: "/api/v1/allmetrics"
      params:
        format: [prometheus_all_hosts]
      honor_labels: true
      static_configs:
      - targets:
        - fw.$DOMAIN:19999
        - nas-0.$DOMAIN:19999
        - nas-1.$DOMAIN:19999
    - job_name: 'home-assistant'
      scrape_interval: 60s
      metrics_path: '/api/prometheus'
      bearer_token: '$HOMEASSISTANT_PROMETHEUS_TOKEN'
      scheme: http
      static_configs:
      - targets:
        - home-assistant.default.svc:8123
grafana:
  adminPassword: "$GRAFANA_PASSWORD"
  grafana.ini:
    server:
      root_url: https://grafana.holthome.net
    auth.basic:
      disable_login_form: true
    auth.generic_oauth:
      enabled: true
      allow_sign_up: true
      name: Dex
      client_id: grafana
      client_secret: $DEX_GRAFANA_CLIENT_SECRET
      scopes: openid profile email groups
      auth_url: https://dex.holthome.net/auth
      token_url: https://dex.holthome.net/token
      api_url: https://dex.holthome.net/userinfo
    auth.generic_oauth.group_mapping:
      role_attribute_path: "contains(groups[*], 'holthome:k8s-admins') && 'Admin' || 'Viewer'"
      org_id: 1
