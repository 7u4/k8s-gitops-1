- name: Check for Ceph being Ready
  command: "{{ item }}"
  with_items:
    - kubectl -n rook-ceph wait --for condition=Established crd/volumes.rook.io
  register: ceph_status
  environment:
    KUBECONFIG: "{{ base }}/setup/kubeconfig"
  changed_when: "'customresourcedefinition.apiextensions.k8s.io/volumes.rook.io condition met' in ceph_status.stdout"
  until: "'customresourcedefinition.apiextensions.k8s.io/volumes.rook.io condition met' in ceph_status.stdout"
  retries: 6
  delay: 30

- debug:
    var: ceph_status